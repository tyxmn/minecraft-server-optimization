## Инструкция по оптимизации minecraft сервера
Эта инструкция поможет максимально оптимизировать minecraft сервер и устранить лаги. После того как вы прочитаете всё до конца и сделаете всё то, что было рекомендовано мною - ваш сервер в 99% случаев будет работать намного лучше и производительнее.
## TPS 
TPS это Ticks per Second, количество тактов в секунду. Чем больше TPS - тем лучше. Если идёт нагрузка и показатель меньше 18.5, консоль выведет такое сообщение: Can't keep up! Is the server overloaded?.. Причины могут быть разными, начиная от скачивания "якобы оптимизирующих" плагинов, заканчивая действиями игроков.

Нормальные показатели это 19.8-20.0 TPS, на этой отметке держаться большинство серверов. Чтобы посмотреть TPS, нужно написать команду в консоль: **tps**.

## Тайминги
Если у вас низкий TPS, необходимо написать такие команды: **/timings on**, ждём 2-3 часа, **/timings paste**. После этого вы получите ссылку и попадёте на сайт, где сможете посмотреть, что нагружает сервер. Пролистав чуть ниже, вы увидите таблицу, где сможете определить, из-за чего опускается TPS. Например, при ванильном спавне мобов значение Minecraft::world - tickEntities будет завышено, а особенно это будет заметно при достаточном количестве игроков. Если самому ничего не понятно и причина лагов не определена - напишите в minecraft-inside или в какой-нибудь другой форум, вам обязательно помогут.

## Плагины

Никогда не ставьте плагины, которые заявляют, что они оптимизируют ваш сервер или плагины, которые изменяют генерацию мира. ClearLagg и ему подобные создают вопиющие лаги, а от EpicWorldGenerator можно ожидать проблем с нагрузкой CPU. Про платный React и LaggRemoverPlus даже упоминать не буду, это просто позор, а не плагины. Также, скачивать плагины можно только с этих сайтов: [spigotmc.org](https://www.spigotmc.org/), [dev.bukkit.org](https://dev.bukkit.org/). Попали на BlackSpigot? Срочно выходите с этого проклятого места. Ничего хорошего оттуда вы точно не скачаете.

Ссылки на плагины, которые действительно оптимизируют сервер: [ServerBooster](https://www.spigotmc.org/resources/%E2%9C%85must-have%E2%9C%85-serverbooster-%E2%9A%A1optimize-your-server-anti-lag-fps-boost-multilanguage%E2%9A%A1.72184/), [Chunky (генерация мира)](https://www.spigotmc.org/resources/chunky.81534/), [MFM](https://www.spigotmc.org/resources/mob-farm-manager-supports-1-7-10-up-to-1-17-hopper-support.15127/).

Касаемо сборок серверов - к ним я отношусь негативно. Лучше не поленитесь и создайте собственную сборку, потому что в ней вы будете разбираться намного лучше, чем в той, который собрал кто-то другой. В сборках частенько присутствуют вирусы. Чтобы посмотреть, есть ли вирусы в вашей сборке, скачайте [этот плагин](https://cdn.discordapp.com/attachments/648298983856406531/856991913646489670/SpigotAV.jar). Он распознаёт вирусы во всех .jar файлах. Если обнаружатся вирусы - консоль выведет такое сообщение: Malware found.

Советую не засорять свой сервер большим количеством плагинов. Чем больше плагинов - тем больше нагрузка на сервер. Добавьте столько плагинов, чтобы вашим игрокам было приятно играть на сервере. Согласитесь, когда вы видите перед собою текст в боссбаре, скорборде, в автоматических сообщениях в чате, а уж тем более надписи на весь экран, желание уйти с этого говна возрастает до 100%. Поверьте, если вы уберёте всю ненужную для обычного игрока информацию, ему будет намного приятнее играть. Администрационные плагины, которые используются раз в никогда - снести, различные дополнения, которыми мало кто будет пользоваться - снести, ненужные плагины просто удаляйте.

## Ядро

Самые популярные форки, которыми можно пользоваться на данный момент: [Paper](https://papermc.io/downloads#Paper-1.17), [Purpur](https://purpur.pl3x.net/downloads/#1.17), [Tuinity](https://ci.codemc.io/job/Spottedleaf/job/Tuinity/), [Airplane](https://github.com/TECHNOVE/Airplane). Я не рекомендую использовать Bukkit и Spigot, так как это пережитки прошлого, которые имеют много проблем. В Paper исправлено много багов и сделано много патчей, с производительностью всё прекрасно. 

Для максимально стабильной и производительной работы, я бы порекомендовал **Airplane**.

## Оптимизированные конфиги

### bukkit.yml

**spawn-limits** - параметр, который отвечает за изменение количества мобов на одного игрока. Эти ограничения применяются только к животным или монстрам в загруженных чанках.

````java
monsters: 40, animals: 8, water-animals: 4, water-ambient: 2, ambient: 2
````

**period-in-ticks** - чем меньше, тем быстрее сервер будет выгружать пустые чанки. Если на вашем сервере играет больше 60 человек, желательно опустить этот параметр до 350.

````java
period-in-ticks: 450
````

**autosave** - если у сервера стоит HDD накопитель, вам придётся страдать от лагов из-за автоматического сохранения. Вы должны иметь SSD накопитель для нормальной работы сервера. Поднимите значение до 12000 для комфортной игры. Кстати, если у вас стоит плагин на автосохранение мира - удалите его, используйте этот параметр, он ничем не хуже.

````java
autosave: 12000
````

### spigot.yml

**save-user-cache-on-stop-only** - этот параметр отключает постоянное сохранение пользовательских данных. Если ваш сервер аварийно выключиться, пользовательские данные не будут сохранены. Желательно перезагружать свой сервер раз в 48-72 часа, чтобы предотвратить потери. Изменяйте этот параметр на свой страх и риск!

````java
save-user-cache-on-stop-only: true
````

**entity-activation-range** - это группа параметров, которая регулирует, насколько близко животные и мобы должны находиться к вам, чтобы активировать свой ИИ. Числа обозначают расстояние в блоках. Если вы выйдите из "зоны активации ИИ" - мобы не будут двигаться, подойдёте обратно - включат свой ИИ. Вот так это всё и работает.

````java
animals: 16
monsters: 24
raiders: 48
misc: 8
````

**merge-radius** - радиус слияния блоков и опыта в кучку. Не повышайте рекомендуемые параметры. Вы же не хотите, чтобы ваши игроки сделали вашу личку вот [такой](https://www.youtube.com/watch?v=zGl796352RI), когда они обнаружат, что их драгоценные алмазы сгорели в лаве?

````java
item: 4.0
exp: 6.0
````

**max-tick-time** - не используйте этот параметр. Значение 1000 отключает его.

````java
max-tick-time: 1000
````

**mob-spawn-range** - этот параметр регулирует радиус спавна мобов возле вас.

````java
mob-spawn-range: 6
````

**arrow-despawn-rate** - стрелы, выпущенные игроками, будут удаляться быстрее, если вы поставите рекомендуемое значение - 300 (15 секунд).

````java
arrow-despawn-rate: 300
````

## Paper.yml

**max-auto-save-chunks-per-tick** - параметр замедляет частоту сохранения чанков. Не опускайте значение ниже 12, иначе некоторые чанки могут не сохраниться вообще. У вас играют меньше 20 игроков? Ставьте 8. Это предел.

````java
max-auto-save-chunks-per-tick: 12
````

**mob-spawner-tick-rate** - тики моба-спавнера. Не поднимайте значение выше.

````java
mob-spawner-tick-rate: 2
````

**disable-chest-cat-protections** - даже котейки вредят серверу, падлы :3 Этот параметр необходимо отключить, потому что по умолчанию сервер постоянно проверяет сундуки, чтобы увидеть, сидит ли на нём котейка.

````java
disable-chest-cat-protections: true
````

**prevent-moving-into-unloaded-chunks** - если игрок каким-то образом попал в незагруженный чанк - он постоянно будет проваливаться вниз (в пустоту), а когда сервер прогрузит чанки, он может с ним сыграть в злую шутку, не телепортировав игрока обратно. Игрок может просто умереть в пустоте. Чтобы такого не произошло, нужно включить данный параметр.

````java
prevent-moving-into-unloaded-chunks: true
````

**armor-stands-tick** - выключив данный параметр, сервер не будет проверять стенды для брони.

````java
armor-stands-tick: false
````

## Мобы

Сервер лагает из-за мобов и вы удостоверились, что это действительно так, открыв тайминги сервера и выставив рекомендуемые параметры выше? Установите [этот плагин](https://www.spigotmc.org/resources/mob-farm-manager-supports-1-7-10-up-to-1-17-hopper-support.15127/).

## Античит

Практически каждый плагин-античит убогий и потребляет слишком много ресурсов, но [Vulkan](https://www.spigotmc.org/resources/vulcan-advanced-cheat-detection-1-7-1-16-5.83626/) совсем не такой. Это лучший анитчит по моему мнению, который производительный, да и к тому же очень мощный!

## Датапаки

Датапаки связанные с мобами/генерацией лучше не использовать, потому что они плохо влияют на производительность. Датапаки лучше заменить плагинами.











